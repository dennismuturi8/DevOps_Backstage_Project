'use strict';

var errors = require('@backstage/errors');
var cliCommon = require('@backstage/cli-common');

const versions = /* @__PURE__ */ new Map();
function detectYarnVersion(dir) {
  const cwd = process.cwd();
  if (versions.has(cwd)) {
    return versions.get(cwd);
  }
  const promise = Promise.resolve().then(async () => {
    try {
      const stdout = await cliCommon.runOutput(["yarn", "--version"], {
        cwd
      });
      return stdout.trim().startsWith("1.") ? "classic" : "berry";
    } catch (error) {
      errors.assertError(error);
      throw new errors.ForwardedError("Failed to determine yarn version", error);
    }
  });
  versions.set(cwd, promise);
  return promise;
}

exports.detectYarnVersion = detectYarnVersion;
//# sourceMappingURL=yarn.cjs.js.map
