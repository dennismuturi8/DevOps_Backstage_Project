{"version":3,"file":"DevDataStore.cjs.js","sources":["../src/DevDataStore.ts"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { BackstageIpcClient, ipcClient } from './ipcClient';\n\ninterface SaveRequest {\n  key: string;\n  data: unknown;\n}\n\ninterface SaveResponse {\n  saved: boolean;\n}\n\ninterface LoadRequest {\n  key: string;\n}\n\ninterface LoadResponse {\n  loaded: boolean;\n  data: unknown;\n}\n\n/**\n * A data store that can be used to store temporary data during development.\n *\n * @public\n */\nexport class DevDataStore {\n  static #instance?: DevDataStore;\n\n  /**\n   * Tries to acquire a DevDataStore instance. This will only succeed when the backend\n   * process is being run through the `@backstage/cli` in development mode.\n   *\n   * @returns A DevDataStore instance, or undefined if not available.\n   */\n  static get(): DevDataStore | undefined {\n    if (ipcClient) {\n      if (!this.#instance) {\n        this.#instance = new DevDataStore(ipcClient);\n      }\n      return this.#instance;\n    }\n    return undefined;\n  }\n\n  /** @internal */\n  static forTest(client: Pick<BackstageIpcClient, 'request'>): DevDataStore {\n    return new DevDataStore(client as BackstageIpcClient);\n  }\n\n  #client: BackstageIpcClient;\n\n  private constructor(client: BackstageIpcClient) {\n    this.#client = client;\n  }\n\n  /**\n   * Save data to the data store.\n   *\n   * @param key - The key used to identify the data.\n   * @param data - The data to save. The data will be serialized using advanced IPC serialization.\n   * @returns A promise that resolves to a result object that indicates whether the data was saved.\n   */\n  async save<T>(key: string, data: T): Promise<{ saved: boolean }> {\n    return this.#client.request<SaveRequest, SaveResponse>(\n      'DevDataStore.save',\n      { key, data },\n    );\n  }\n\n  /**\n   * Loads data from the data store.\n   *\n   * @param key - The key used to identify the data.\n   * @returns A promise that resolves to a result object that indicates whether the data was loaded, as well as the data.\n   */\n  async load<T>(key: string): Promise<{ loaded: boolean; data: T }> {\n    const result = await this.#client.request<LoadRequest, LoadResponse>(\n      'DevDataStore.load',\n      { key },\n    );\n    return result as { loaded: boolean; data: T };\n  }\n}\n"],"names":["ipcClient"],"mappings":";;;;AAyCO,MAAM,YAAA,CAAa;AAAA,EACxB,OAAO,SAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQP,OAAO,GAAA,GAAgC;AACrC,IAAA,IAAIA,mBAAA,EAAW;AACb,MAAA,IAAI,CAAC,KAAK,SAAA,EAAW;AACnB,QAAA,IAAA,CAAK,SAAA,GAAY,IAAI,YAAA,CAAaA,mBAAS,CAAA;AAAA,MAC7C;AACA,MAAA,OAAO,IAAA,CAAK,SAAA;AAAA,IACd;AACA,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA,EAGA,OAAO,QAAQ,MAAA,EAA2D;AACxE,IAAA,OAAO,IAAI,aAAa,MAA4B,CAAA;AAAA,EACtD;AAAA,EAEA,OAAA;AAAA,EAEQ,YAAY,MAAA,EAA4B;AAC9C,IAAA,IAAA,CAAK,OAAA,GAAU,MAAA;AAAA,EACjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,MAAM,IAAA,CAAQ,GAAA,EAAa,IAAA,EAAsC;AAC/D,IAAA,OAAO,KAAK,OAAA,CAAQ,OAAA;AAAA,MAClB,mBAAA;AAAA,MACA,EAAE,KAAK,IAAA;AAAK,KACd;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAM,KAAQ,GAAA,EAAoD;AAChE,IAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,OAAA,CAAQ,OAAA;AAAA,MAChC,mBAAA;AAAA,MACA,EAAE,GAAA;AAAI,KACR;AACA,IAAA,OAAO,MAAA;AAAA,EACT;AACF;;;;"}