{"version":3,"file":"proxyBootstrap.cjs.js","sources":["../src/proxyBootstrap.ts"],"sourcesContent":["/*\n * Copyright 2025 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * This function can be called to setup undici and node-fetch Proxy agents.\n *\n * You can set GLOBAL_AGENT_HTTP(S)_PROXY to configure a proxy to be used in the\n * CLIs.\n *\n * You can also configure a custom namespace by setting\n * GLOBAL_AGENT_ENVIRONMENT_VARIABLE_NAMESPACE which will replace the default\n * \"GLOBAL_AGENT_\" env-var prefix.\n *\n * Make sure to call this function before any other imports.\n *\n * @public\n */\nexport function bootstrapEnvProxyAgents() {\n  // see https://www.npmjs.com/package/global-agent\n  const globalAgentNamespace =\n    process.env.GLOBAL_AGENT_ENVIRONMENT_VARIABLE_NAMESPACE ?? 'GLOBAL_AGENT_';\n  if (\n    process.env[`${globalAgentNamespace}HTTP_PROXY`] ||\n    process.env[`${globalAgentNamespace}HTTPS_PROXY`]\n  ) {\n    const globalAgent =\n      require('global-agent') as typeof import('global-agent');\n    globalAgent.bootstrap();\n  }\n\n  if (process.env.HTTP_PROXY || process.env.HTTPS_PROXY) {\n    const { setGlobalDispatcher, EnvHttpProxyAgent } =\n      require('undici') as typeof import('undici');\n    setGlobalDispatcher(new EnvHttpProxyAgent());\n  }\n}\n"],"names":[],"mappings":";;AA8BO,SAAS,uBAAA,GAA0B;AAExC,EAAA,MAAM,oBAAA,GACJ,OAAA,CAAQ,GAAA,CAAI,2CAAA,IAA+C,eAAA;AAC7D,EAAA,IACE,OAAA,CAAQ,GAAA,CAAI,CAAA,EAAG,oBAAoB,CAAA,UAAA,CAAY,CAAA,IAC/C,OAAA,CAAQ,GAAA,CAAI,CAAA,EAAG,oBAAoB,CAAA,WAAA,CAAa,CAAA,EAChD;AACA,IAAA,MAAM,WAAA,GACJ,QAAQ,cAAc,CAAA;AACxB,IAAA,WAAA,CAAY,SAAA,EAAU;AAAA,EACxB;AAEA,EAAA,IAAI,OAAA,CAAQ,GAAA,CAAI,UAAA,IAAc,OAAA,CAAQ,IAAI,WAAA,EAAa;AACrD,IAAA,MAAM,EAAE,mBAAA,EAAqB,iBAAA,EAAkB,GAC7C,QAAQ,QAAQ,CAAA;AAClB,IAAA,mBAAA,CAAoB,IAAI,mBAAmB,CAAA;AAAA,EAC7C;AACF;;;;"}