'use strict';

var parsing = require('../../../../entrypoints/discovery/parsing.cjs.js');

function getPlugins(config) {
  const endpoints = parsing.getEndpoints(config);
  return Array.from(new Set(endpoints.flatMap((endpoint) => endpoint.plugins)));
}
class DefaultRootSystemMetadataService {
  #plugins;
  #instanceMetadata;
  constructor(options) {
    const { config } = options;
    this.#plugins = getPlugins(config);
    config.subscribe?.(() => {
      this.#plugins = getPlugins(config);
    });
    this.#instanceMetadata = options.instanceMetadata;
  }
  static create(pluginEnv) {
    return new DefaultRootSystemMetadataService(pluginEnv);
  }
  async getInstalledPlugins() {
    const plugins = this.#plugins.map((pluginId) => ({ pluginId }));
    for (const plugin of await this.#instanceMetadata.getInstalledPlugins()) {
      plugins.push({ pluginId: plugin.pluginId });
    }
    return plugins;
  }
}

exports.DefaultRootSystemMetadataService = DefaultRootSystemMetadataService;
//# sourceMappingURL=DefaultRootSystemMetadataService.cjs.js.map
