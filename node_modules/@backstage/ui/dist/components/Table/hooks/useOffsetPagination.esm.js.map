{"version":3,"file":"useOffsetPagination.esm.js","sources":["../../../../src/components/Table/hooks/useOffsetPagination.ts"],"sourcesContent":["/*\n * Copyright 2025 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { useState, useCallback } from 'react';\nimport type { TableItem } from '../types';\nimport type {\n  UseTableOffsetOptions,\n  OffsetParams,\n  QueryState,\n  PaginationResult,\n} from './types';\nimport { usePageCache } from './usePageCache';\nimport { useStableCallback } from './useStableCallback';\nimport { useDebouncedReload } from './useDebouncedReload';\nimport { getEffectivePageSize } from './getEffectivePageSize';\n\nexport function useOffsetPagination<T extends TableItem, TFilter>(\n  options: UseTableOffsetOptions<T, TFilter>,\n  query: QueryState<TFilter>,\n): PaginationResult<T> & { reload: () => void } {\n  const { getData: getDataProp, paginationOptions = {} } = options;\n  const { initialOffset = 0 } = paginationOptions;\n  const defaultPageSize = getEffectivePageSize(paginationOptions);\n\n  const getData = useStableCallback(getDataProp);\n  const { sort, filter, search } = query;\n\n  const [pageSize, setPageSize] = useState(defaultPageSize);\n\n  const wrappedGetData = useCallback(\n    async ({\n      cursor,\n      signal,\n    }: {\n      cursor: number | undefined;\n      signal: AbortSignal;\n    }) => {\n      const currentOffset = cursor ?? 0;\n\n      const params: OffsetParams<TFilter> = {\n        offset: currentOffset,\n        pageSize,\n        sort,\n        filter,\n        search,\n        signal,\n      };\n\n      const response = await getData(params);\n\n      const prevCursor =\n        currentOffset > 0 ? Math.max(0, currentOffset - pageSize) : undefined;\n      const nextCursor =\n        currentOffset + pageSize < response.totalCount\n          ? currentOffset + pageSize\n          : undefined;\n\n      return {\n        data: response.data,\n        prevCursor,\n        nextCursor,\n        totalCount: response.totalCount,\n      };\n    },\n    [getData, pageSize, sort, filter, search],\n  );\n\n  const cache = usePageCache<T, number>({\n    getData: wrappedGetData,\n    initialCurrentCursor: initialOffset > 0 ? initialOffset : undefined,\n  });\n\n  useDebouncedReload(query, pageSize, cache.reload);\n\n  const onPageSizeChange = useCallback(\n    (newSize: number) => setPageSize(newSize),\n    [],\n  );\n\n  return {\n    data: cache.data,\n    loading: cache.loading,\n    error: cache.error,\n    totalCount: cache.totalCount,\n    offset: cache.currentCursor ?? 0,\n    pageSize,\n    hasNextPage: cache.hasNextPage,\n    hasPreviousPage: cache.hasPreviousPage,\n    onNextPage: cache.onNextPage,\n    onPreviousPage: cache.onPreviousPage,\n    onPageSizeChange,\n    reload: cache.reload,\n  };\n}\n"],"names":[],"mappings":";;;;;;AA4BO,SAAS,mBAAA,CACd,SACA,KAAA,EAC8C;AAC9C,EAAA,MAAM,EAAE,OAAA,EAAS,WAAA,EAAa,iBAAA,GAAoB,IAAG,GAAI,OAAA;AACzD,EAAA,MAAM,EAAE,aAAA,GAAgB,CAAA,EAAE,GAAI,iBAAA;AAC9B,EAAA,MAAM,eAAA,GAAkB,qBAAqB,iBAAiB,CAAA;AAE9D,EAAA,MAAM,OAAA,GAAU,kBAAkB,WAAW,CAAA;AAC7C,EAAA,MAAM,EAAE,IAAA,EAAM,MAAA,EAAQ,MAAA,EAAO,GAAI,KAAA;AAEjC,EAAA,MAAM,CAAC,QAAA,EAAU,WAAW,CAAA,GAAI,SAAS,eAAe,CAAA;AAExD,EAAA,MAAM,cAAA,GAAiB,WAAA;AAAA,IACrB,OAAO;AAAA,MACL,MAAA;AAAA,MACA;AAAA,KACF,KAGM;AACJ,MAAA,MAAM,gBAAgB,MAAA,IAAU,CAAA;AAEhC,MAAA,MAAM,MAAA,GAAgC;AAAA,QACpC,MAAA,EAAQ,aAAA;AAAA,QACR,QAAA;AAAA,QACA,IAAA;AAAA,QACA,MAAA;AAAA,QACA,MAAA;AAAA,QACA;AAAA,OACF;AAEA,MAAA,MAAM,QAAA,GAAW,MAAM,OAAA,CAAQ,MAAM,CAAA;AAErC,MAAA,MAAM,UAAA,GACJ,gBAAgB,CAAA,GAAI,IAAA,CAAK,IAAI,CAAA,EAAG,aAAA,GAAgB,QAAQ,CAAA,GAAI,MAAA;AAC9D,MAAA,MAAM,aACJ,aAAA,GAAgB,QAAA,GAAW,QAAA,CAAS,UAAA,GAChC,gBAAgB,QAAA,GAChB,MAAA;AAEN,MAAA,OAAO;AAAA,QACL,MAAM,QAAA,CAAS,IAAA;AAAA,QACf,UAAA;AAAA,QACA,UAAA;AAAA,QACA,YAAY,QAAA,CAAS;AAAA,OACvB;AAAA,IACF,CAAA;AAAA,IACA,CAAC,OAAA,EAAS,QAAA,EAAU,IAAA,EAAM,QAAQ,MAAM;AAAA,GAC1C;AAEA,EAAA,MAAM,QAAQ,YAAA,CAAwB;AAAA,IACpC,OAAA,EAAS,cAAA;AAAA,IACT,oBAAA,EAAsB,aAAA,GAAgB,CAAA,GAAI,aAAA,GAAgB;AAAA,GAC3D,CAAA;AAED,EAAA,kBAAA,CAAmB,KAAA,EAAO,QAAA,EAAU,KAAA,CAAM,MAAM,CAAA;AAEhD,EAAA,MAAM,gBAAA,GAAmB,WAAA;AAAA,IACvB,CAAC,OAAA,KAAoB,WAAA,CAAY,OAAO,CAAA;AAAA,IACxC;AAAC,GACH;AAEA,EAAA,OAAO;AAAA,IACL,MAAM,KAAA,CAAM,IAAA;AAAA,IACZ,SAAS,KAAA,CAAM,OAAA;AAAA,IACf,OAAO,KAAA,CAAM,KAAA;AAAA,IACb,YAAY,KAAA,CAAM,UAAA;AAAA,IAClB,MAAA,EAAQ,MAAM,aAAA,IAAiB,CAAA;AAAA,IAC/B,QAAA;AAAA,IACA,aAAa,KAAA,CAAM,WAAA;AAAA,IACnB,iBAAiB,KAAA,CAAM,eAAA;AAAA,IACvB,YAAY,KAAA,CAAM,UAAA;AAAA,IAClB,gBAAgB,KAAA,CAAM,cAAA;AAAA,IACtB,gBAAA;AAAA,IACA,QAAQ,KAAA,CAAM;AAAA,GAChB;AACF;;;;"}