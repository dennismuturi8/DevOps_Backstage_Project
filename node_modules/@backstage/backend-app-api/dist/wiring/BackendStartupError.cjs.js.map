{"version":3,"file":"BackendStartupError.cjs.js","sources":["../../src/wiring/BackendStartupError.ts"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CustomErrorBase } from '@backstage/errors';\nimport { BackendStartupResult } from './types';\n\nfunction formatMessage(startupResult: BackendStartupResult): string {\n  const parts: string[] = [\n    'Backend startup failed due to the following errors:',\n  ];\n  const failures: string[] = [];\n\n  for (const plugin of startupResult.plugins) {\n    if (plugin.failure && !plugin.failure.allowed) {\n      failures.push(\n        `  Plugin '${plugin.pluginId}' startup failed; caused by ${plugin.failure.error}`,\n      );\n    }\n\n    for (const mod of plugin.modules) {\n      if (mod.failure && !mod.failure.allowed) {\n        failures.push(\n          `  Module '${mod.moduleId}' for plugin '${plugin.pluginId}' startup failed; caused by ${mod.failure.error}`,\n        );\n      }\n    }\n  }\n\n  if (failures.length > 0) {\n    parts.push(...failures);\n  }\n\n  return parts.join('\\n');\n}\n\n/**\n * Error thrown when backend startup fails.\n * Includes detailed startup results for all plugins and modules.\n *\n * @public\n */\nexport class BackendStartupError extends CustomErrorBase {\n  name = 'BackendStartupError' as const;\n\n  /**\n   * The startup results for all plugins and modules.\n   */\n  readonly #startupResult: BackendStartupResult;\n\n  constructor(startupResult: BackendStartupResult) {\n    super(formatMessage(startupResult));\n    this.#startupResult = startupResult;\n  }\n\n  get result(): BackendStartupResult {\n    return this.#startupResult;\n  }\n}\n"],"names":["CustomErrorBase"],"mappings":";;;;AAmBA,SAAS,cAAc,aAAA,EAA6C;AAClE,EAAA,MAAM,KAAA,GAAkB;AAAA,IACtB;AAAA,GACF;AACA,EAAA,MAAM,WAAqB,EAAC;AAE5B,EAAA,KAAA,MAAW,MAAA,IAAU,cAAc,OAAA,EAAS;AAC1C,IAAA,IAAI,MAAA,CAAO,OAAA,IAAW,CAAC,MAAA,CAAO,QAAQ,OAAA,EAAS;AAC7C,MAAA,QAAA,CAAS,IAAA;AAAA,QACP,aAAa,MAAA,CAAO,QAAQ,CAAA,4BAAA,EAA+B,MAAA,CAAO,QAAQ,KAAK,CAAA;AAAA,OACjF;AAAA,IACF;AAEA,IAAA,KAAA,MAAW,GAAA,IAAO,OAAO,OAAA,EAAS;AAChC,MAAA,IAAI,GAAA,CAAI,OAAA,IAAW,CAAC,GAAA,CAAI,QAAQ,OAAA,EAAS;AACvC,QAAA,QAAA,CAAS,IAAA;AAAA,UACP,CAAA,UAAA,EAAa,IAAI,QAAQ,CAAA,cAAA,EAAiB,OAAO,QAAQ,CAAA,4BAAA,EAA+B,GAAA,CAAI,OAAA,CAAQ,KAAK,CAAA;AAAA,SAC3G;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAEA,EAAA,IAAI,QAAA,CAAS,SAAS,CAAA,EAAG;AACvB,IAAA,KAAA,CAAM,IAAA,CAAK,GAAG,QAAQ,CAAA;AAAA,EACxB;AAEA,EAAA,OAAO,KAAA,CAAM,KAAK,IAAI,CAAA;AACxB;AAQO,MAAM,4BAA4BA,sBAAA,CAAgB;AAAA,EACvD,IAAA,GAAO,qBAAA;AAAA;AAAA;AAAA;AAAA,EAKE,cAAA;AAAA,EAET,YAAY,aAAA,EAAqC;AAC/C,IAAA,KAAA,CAAM,aAAA,CAAc,aAAa,CAAC,CAAA;AAClC,IAAA,IAAA,CAAK,cAAA,GAAiB,aAAA;AAAA,EACxB;AAAA,EAEA,IAAI,MAAA,GAA+B;AACjC,IAAA,OAAO,IAAA,CAAK,cAAA;AAAA,EACd;AACF;;;;"}