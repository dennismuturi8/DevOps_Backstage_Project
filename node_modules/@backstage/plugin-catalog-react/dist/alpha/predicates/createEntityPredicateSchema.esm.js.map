{"version":3,"file":"createEntityPredicateSchema.esm.js","sources":["../../../src/alpha/predicates/createEntityPredicateSchema.ts"],"sourcesContent":["/*\n * Copyright 2025 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  EntityPredicate,\n  EntityPredicateExpression,\n  EntityPredicatePrimitive,\n  EntityPredicateValue,\n} from './types';\nimport type { z as zImpl, ZodType } from 'zod';\n\n/** @internal */\nexport function createEntityPredicateSchema(z: typeof zImpl) {\n  const primitiveSchema = z.union([\n    z.string(),\n    z.number(),\n    z.boolean(),\n  ]) as ZodType<EntityPredicatePrimitive>;\n\n  // eslint-disable-next-line prefer-const\n  let valuePredicateSchema: ZodType<EntityPredicateValue>;\n\n  const expressionSchema = z.lazy(() =>\n    z.union([\n      z.record(z.string().regex(/^(?!\\$).*$/), valuePredicateSchema),\n      z.record(z.string().regex(/^\\$/), z.never()),\n    ]),\n  ) as ZodType<EntityPredicateExpression>;\n\n  const predicateSchema = z.lazy(() =>\n    z.union([\n      expressionSchema,\n      primitiveSchema,\n      z.object({ $all: z.array(predicateSchema) }),\n      z.object({ $any: z.array(predicateSchema) }),\n      z.object({ $not: predicateSchema }),\n    ]),\n  ) as ZodType<EntityPredicate>;\n\n  valuePredicateSchema = z.union([\n    primitiveSchema,\n    z.object({ $exists: z.boolean() }),\n    z.object({ $in: z.array(primitiveSchema) }),\n    z.object({ $contains: predicateSchema }),\n  ]) as ZodType<EntityPredicateValue>;\n\n  return predicateSchema;\n}\n"],"names":[],"mappings":"AAyBO,SAAS,4BAA4B,CAAA,EAAiB;AAC3D,EAAA,MAAM,eAAA,GAAkB,EAAE,KAAA,CAAM;AAAA,IAC9B,EAAE,MAAA,EAAO;AAAA,IACT,EAAE,MAAA,EAAO;AAAA,IACT,EAAE,OAAA;AAAQ,GACX,CAAA;AAGD,EAAA,IAAI,oBAAA;AAEJ,EAAA,MAAM,mBAAmB,CAAA,CAAE,IAAA;AAAA,IAAK,MAC9B,EAAE,KAAA,CAAM;AAAA,MACN,CAAA,CAAE,OAAO,CAAA,CAAE,MAAA,GAAS,KAAA,CAAM,YAAY,GAAG,oBAAoB,CAAA;AAAA,MAC7D,CAAA,CAAE,MAAA,CAAO,CAAA,CAAE,MAAA,EAAO,CAAE,MAAM,KAAK,CAAA,EAAG,CAAA,CAAE,KAAA,EAAO;AAAA,KAC5C;AAAA,GACH;AAEA,EAAA,MAAM,kBAAkB,CAAA,CAAE,IAAA;AAAA,IAAK,MAC7B,EAAE,KAAA,CAAM;AAAA,MACN,gBAAA;AAAA,MACA,eAAA;AAAA,MACA,CAAA,CAAE,OAAO,EAAE,IAAA,EAAM,EAAE,KAAA,CAAM,eAAe,GAAG,CAAA;AAAA,MAC3C,CAAA,CAAE,OAAO,EAAE,IAAA,EAAM,EAAE,KAAA,CAAM,eAAe,GAAG,CAAA;AAAA,MAC3C,CAAA,CAAE,MAAA,CAAO,EAAE,IAAA,EAAM,iBAAiB;AAAA,KACnC;AAAA,GACH;AAEA,EAAA,oBAAA,GAAuB,EAAE,KAAA,CAAM;AAAA,IAC7B,eAAA;AAAA,IACA,EAAE,MAAA,CAAO,EAAE,SAAS,CAAA,CAAE,OAAA,IAAW,CAAA;AAAA,IACjC,CAAA,CAAE,OAAO,EAAE,GAAA,EAAK,EAAE,KAAA,CAAM,eAAe,GAAG,CAAA;AAAA,IAC1C,CAAA,CAAE,MAAA,CAAO,EAAE,SAAA,EAAW,iBAAiB;AAAA,GACxC,CAAA;AAED,EAAA,OAAO,eAAA;AACT;;;;"}