{"version":3,"file":"useTable.esm.js","sources":["../../../../src/components/Table/hooks/useTable.ts"],"sourcesContent":["/*\n * Copyright 2025 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { useMemo, useRef } from 'react';\nimport type { SortState, TableItem, TableProps } from '../types';\nimport type {\n  PaginationOptions,\n  PaginationResult,\n  UseTableOptions,\n  UseTableResult,\n} from './types';\nimport { useQueryState } from './useQueryState';\nimport { useCompletePagination } from './useCompletePagination';\nimport { useCursorPagination } from './useCursorPagination';\nimport { useOffsetPagination } from './useOffsetPagination';\n\nfunction useTableProps<T extends TableItem>(\n  paginationResult: PaginationResult<T>,\n  sortState: SortState,\n  paginationOptions: PaginationOptions = {},\n): Omit<\n  TableProps<T>,\n  'columnConfig' | 'rowConfig' | 'selection' | 'emptyState'\n> {\n  const {\n    showPageSizeOptions = true,\n    pageSizeOptions,\n    onPageSizeChange: onPageSizeChangeCallback,\n    onNextPage: onNextPageCallback,\n    onPreviousPage: onPreviousPageCallback,\n    getLabel,\n  } = paginationOptions;\n\n  const previousDataRef = useRef(paginationResult.data);\n  if (paginationResult.data) {\n    previousDataRef.current = paginationResult.data;\n  }\n\n  const displayData = paginationResult.data ?? previousDataRef.current;\n  const isStale = paginationResult.loading && displayData !== undefined;\n\n  const pagination = useMemo(\n    () => ({\n      type: 'page' as const,\n      pageSize: paginationResult.pageSize,\n      pageSizeOptions,\n      offset: paginationResult.offset,\n      totalCount: paginationResult.totalCount,\n      hasNextPage: paginationResult.hasNextPage,\n      hasPreviousPage: paginationResult.hasPreviousPage,\n      onNextPage: () => {\n        paginationResult.onNextPage();\n        onNextPageCallback?.();\n      },\n      onPreviousPage: () => {\n        paginationResult.onPreviousPage();\n        onPreviousPageCallback?.();\n      },\n      onPageSizeChange: (size: number) => {\n        paginationResult.onPageSizeChange(size);\n        onPageSizeChangeCallback?.(size);\n      },\n      showPageSizeOptions,\n      getLabel,\n    }),\n    [\n      paginationResult.pageSize,\n      pageSizeOptions,\n      paginationResult.offset,\n      paginationResult.totalCount,\n      paginationResult.hasNextPage,\n      paginationResult.hasPreviousPage,\n      paginationResult.onNextPage,\n      paginationResult.onPreviousPage,\n      paginationResult.onPageSizeChange,\n      onNextPageCallback,\n      onPreviousPageCallback,\n      onPageSizeChangeCallback,\n    ],\n  );\n\n  return useMemo(\n    () => ({\n      data: displayData,\n      loading: paginationResult.loading,\n      isStale,\n      error: paginationResult.error,\n      pagination,\n      sort: sortState,\n    }),\n    [\n      displayData,\n      paginationResult.loading,\n      isStale,\n      paginationResult.error,\n      pagination,\n      showPageSizeOptions,\n      getLabel,\n      sortState,\n    ],\n  );\n}\n\n/** @public */\nexport function useTable<T extends TableItem, TFilter = unknown>(\n  options: UseTableOptions<T, TFilter>,\n): UseTableResult<T, TFilter> {\n  const query = useQueryState<TFilter>(options);\n\n  const initialModeRef = useRef(options.mode);\n  if (initialModeRef.current !== options.mode) {\n    throw new Error(\n      `useTable mode cannot change from '${initialModeRef.current}' to '${options.mode}'. ` +\n        `The mode must remain stable for the lifetime of the component.`,\n    );\n  }\n\n  let pagination: PaginationResult<T> & { reload: () => void };\n\n  if (options.mode === 'complete') {\n    pagination = useCompletePagination(options, query);\n  } else if (options.mode === 'offset') {\n    pagination = useOffsetPagination(options, query);\n  } else if (options.mode === 'cursor') {\n    pagination = useCursorPagination(options, query);\n  } else {\n    throw new Error('Invalid mode');\n  }\n\n  const sortState: SortState = useMemo(\n    () => ({ descriptor: query.sort, onSortChange: query.setSort }),\n    [query.sort, query.setSort],\n  );\n\n  const tableProps = useTableProps(\n    pagination,\n    sortState,\n    options.paginationOptions ?? {},\n  );\n\n  return {\n    tableProps,\n    reload: pagination.reload,\n    filter: { value: query.filter, onChange: query.setFilter },\n    search: { value: query.search, onChange: query.setSearch },\n  };\n}\n"],"names":[],"mappings":"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"}