{"version":3,"file":"createRegisterCatalogEntitiesAction.cjs.js","sources":["../../src/actions/createRegisterCatalogEntitiesAction.ts"],"sourcesContent":["/*\n * Copyright 2025 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { ActionsRegistryService } from '@backstage/backend-plugin-api/alpha';\nimport { InputError } from '@backstage/errors';\nimport { CatalogService } from '@backstage/plugin-catalog-node';\n\nconst isValidUrl = (url: string) => {\n  try {\n    // eslint-disable-next-line no-new\n    new URL(url);\n    return true;\n  } catch (error) {\n    return false;\n  }\n};\n\nexport const createRegisterCatalogEntitiesAction = ({\n  catalog,\n  actionsRegistry,\n}: {\n  catalog: CatalogService;\n  actionsRegistry: ActionsRegistryService;\n}) => {\n  actionsRegistry.register({\n    name: 'register-entity',\n    title: 'Register entity in the Catalog',\n    attributes: {\n      destructive: false,\n      readOnly: false,\n      idempotent: false,\n    },\n    description: `Registers one or more entities in the Backstage catalog by creating a Location entity that points to a remote catalog-info.yaml file.\n\nThis action is similar to the \"Register existing component\" flow in the Backstage UI, where you provide a URL to a catalog-info.yaml file describing catalog entities such as Components, Systems, Resources, APIs, Users, and Groups. The action will create a new Location entity that references the provided file; all entities defined within that file will be imported into the catalog.\n\nA unique identifier (locationId) will be returned for the newly created Location. You can use this identifier in the future to unregister or delete the Location and all entities it owns.\n`,\n    schema: {\n      input: z =>\n        z.object({\n          locationUrl: z\n            .string()\n            .describe(\n              `URL reference to the catalog-info.yaml file that describes the entity to register. For example: https://github.com/backstage/demo/blob/master/catalog-info.yaml`,\n            ),\n        }),\n      output: z =>\n        z.object({\n          locationId: z\n            .string()\n            .describe('The ID of the entity that was registered'),\n        }),\n    },\n    action: async ({ input, credentials }) => {\n      if (!isValidUrl(input.locationUrl)) {\n        throw new InputError(`${input.locationUrl} is an invalid URL`);\n      }\n\n      const result = await catalog.addLocation(\n        {\n          type: 'url',\n          target: input.locationUrl,\n        },\n        {\n          credentials,\n        },\n      );\n\n      return {\n        output: {\n          locationId: result.location.id,\n        },\n      };\n    },\n  });\n};\n"],"names":["InputError"],"mappings":";;;;AAmBA,MAAM,UAAA,GAAa,CAAC,GAAA,KAAgB;AAClC,EAAA,IAAI;AAEF,IAAA,IAAI,IAAI,GAAG,CAAA;AACX,IAAA,OAAO,IAAA;AAAA,EACT,SAAS,KAAA,EAAO;AACd,IAAA,OAAO,KAAA;AAAA,EACT;AACF,CAAA;AAEO,MAAM,sCAAsC,CAAC;AAAA,EAClD,OAAA;AAAA,EACA;AACF,CAAA,KAGM;AACJ,EAAA,eAAA,CAAgB,QAAA,CAAS;AAAA,IACvB,IAAA,EAAM,iBAAA;AAAA,IACN,KAAA,EAAO,gCAAA;AAAA,IACP,UAAA,EAAY;AAAA,MACV,WAAA,EAAa,KAAA;AAAA,MACb,QAAA,EAAU,KAAA;AAAA,MACV,UAAA,EAAY;AAAA,KACd;AAAA,IACA,WAAA,EAAa,CAAA;;AAAA;;AAAA;AAAA,CAAA;AAAA,IAMb,MAAA,EAAQ;AAAA,MACN,KAAA,EAAO,CAAA,CAAA,KACL,CAAA,CAAE,MAAA,CAAO;AAAA,QACP,WAAA,EAAa,CAAA,CACV,MAAA,EAAO,CACP,QAAA;AAAA,UACC,CAAA,+JAAA;AAAA;AACF,OACH,CAAA;AAAA,MACH,MAAA,EAAQ,CAAA,CAAA,KACN,CAAA,CAAE,MAAA,CAAO;AAAA,QACP,UAAA,EAAY,CAAA,CACT,MAAA,EAAO,CACP,SAAS,0CAA0C;AAAA,OACvD;AAAA,KACL;AAAA,IACA,MAAA,EAAQ,OAAO,EAAE,KAAA,EAAO,aAAY,KAAM;AACxC,MAAA,IAAI,CAAC,UAAA,CAAW,KAAA,CAAM,WAAW,CAAA,EAAG;AAClC,QAAA,MAAM,IAAIA,iBAAA,CAAW,CAAA,EAAG,KAAA,CAAM,WAAW,CAAA,kBAAA,CAAoB,CAAA;AAAA,MAC/D;AAEA,MAAA,MAAM,MAAA,GAAS,MAAM,OAAA,CAAQ,WAAA;AAAA,QAC3B;AAAA,UACE,IAAA,EAAM,KAAA;AAAA,UACN,QAAQ,KAAA,CAAM;AAAA,SAChB;AAAA,QACA;AAAA,UACE;AAAA;AACF,OACF;AAEA,MAAA,OAAO;AAAA,QACL,MAAA,EAAQ;AAAA,UACN,UAAA,EAAY,OAAO,QAAA,CAAS;AAAA;AAC9B,OACF;AAAA,IACF;AAAA,GACD,CAAA;AACH;;;;"}