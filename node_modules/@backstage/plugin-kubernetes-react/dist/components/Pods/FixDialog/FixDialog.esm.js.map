{"version":3,"file":"FixDialog.esm.js","sources":["../../../../src/components/Pods/FixDialog/FixDialog.tsx"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { FC, useState } from 'react';\n\nimport Button from '@material-ui/core/Button';\nimport Grid from '@material-ui/core/Grid';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport IconButton from '@material-ui/core/IconButton';\nimport { makeStyles, createStyles, Theme } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport CloseIcon from '@material-ui/icons/Close';\nimport HelpIcon from '@material-ui/icons/Help';\nimport OpenInNewIcon from '@material-ui/icons/OpenInNew';\n\nimport { Pod } from 'kubernetes-models/v1/Pod';\nimport { DetectedError } from '@backstage/plugin-kubernetes-common';\nimport { PodLogs } from '../PodLogs';\nimport { Events } from '../Events';\nimport { LinkButton } from '@backstage/core-components';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport { useTranslationRef } from '@backstage/core-plugin-api/alpha';\nimport { kubernetesReactTranslationRef } from '../../../translation';\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    closeButton: {\n      position: 'absolute',\n      right: theme.spacing(1),\n      top: theme.spacing(1),\n      color: theme.palette.grey[500],\n    },\n  }),\n);\n\n/**\n * Props for FixDialog\n *\n * @public\n */\nexport interface FixDialogProps {\n  open?: boolean;\n  clusterName: string;\n  pod: Pod;\n  error: DetectedError;\n}\n\n/**\n * A dialog for fixing detected Kubernetes errors\n *\n * @public\n */\nexport const FixDialog: FC<FixDialogProps> = ({\n  open,\n  pod,\n  error,\n  clusterName,\n}: FixDialogProps) => {\n  const [isOpen, setOpen] = useState(!!open);\n  const classes = useStyles();\n  const { t } = useTranslationRef(kubernetesReactTranslationRef);\n\n  const openDialog = () => {\n    setOpen(true);\n  };\n\n  const closeDialog = () => {\n    setOpen(false);\n  };\n\n  const pf = error.proposedFix;\n\n  const dialogContent = () => {\n    return (\n      <Grid container>\n        <Grid item xs={12}>\n          <Typography variant=\"h6\">{t('fixDialog.detectedError')}</Typography>\n          <Typography>{error.message}</Typography>\n        </Grid>\n        <Grid item xs={12}>\n          <Typography variant=\"h6\">\n            {t('fixDialog.causeExplanation')}\n          </Typography>\n          <Typography>\n            {error.proposedFix?.rootCauseExplanation ?? t('podsTable.unknown')}\n          </Typography>\n        </Grid>\n        <Grid item xs={12}>\n          <Typography variant=\"h6\">{t('fixDialog.fix')}</Typography>\n          <List>\n            {(error.proposedFix?.actions ?? []).map((fix, i) => {\n              return (\n                <ListItem\n                  key={`${\n                    pod.metadata?.name ?? t('podsTable.unknown')\n                  }-pf-${i}`}\n                >\n                  {fix}\n                </ListItem>\n              );\n            })}\n          </List>\n        </Grid>\n\n        {pf && pf.type === 'logs' && (\n          <>\n            <Grid item xs={12}>\n              <Typography variant=\"h6\">{t('fixDialog.crashLogs')}</Typography>\n            </Grid>\n            <Grid item xs={9}>\n              <PodLogs\n                previous\n                containerScope={{\n                  podName: pod.metadata?.name ?? t('podsTable.unknown'),\n                  podNamespace:\n                    pod.metadata?.namespace ?? t('podsTable.unknown'),\n                  cluster: { name: clusterName },\n                  containerName: pf.container,\n                }}\n              />\n            </Grid>\n          </>\n        )}\n        {pf && pf.type === 'events' && (\n          <>\n            <Grid item xs={12}>\n              <Typography variant=\"h6\">{t('fixDialog.events')}</Typography>\n            </Grid>\n            <Grid item xs={9}>\n              <Events\n                warningEventsOnly\n                involvedObjectName={pod.metadata?.name ?? ''}\n                namespace={pod.metadata?.namespace ?? ''}\n                clusterName={clusterName}\n              />\n            </Grid>\n          </>\n        )}\n      </Grid>\n    );\n  };\n\n  return (\n    <>\n      <Button\n        variant=\"outlined\"\n        aria-label={t('fixDialog.ariaLabels.fixIssue')}\n        component=\"label\"\n        onClick={openDialog}\n        startIcon={<HelpIcon />}\n      >\n        {t('fixDialog.helpButton')}\n      </Button>\n      <Dialog maxWidth=\"xl\" fullWidth open={isOpen} onClose={closeDialog}>\n        <DialogTitle id=\"dialog-title\">\n          {t('fixDialog.title', {\n            podName: pod.metadata?.name ?? '',\n            errorType: error.type,\n          })}\n          <IconButton\n            aria-label={t('fixDialog.ariaLabels.close')}\n            className={classes.closeButton}\n            onClick={closeDialog}\n          >\n            <CloseIcon />\n          </IconButton>\n        </DialogTitle>\n        <DialogContent>{dialogContent()}</DialogContent>\n        <DialogActions>\n          {pf && pf.type === 'docs' && (\n            <LinkButton\n              to={pf.docsLink}\n              variant=\"outlined\"\n              startIcon={<OpenInNewIcon />}\n              target=\"_blank\"\n              rel=\"noopener\"\n            >\n              {t('fixDialog.openDocs')}\n            </LinkButton>\n          )}\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n"],"names":[],"mappings":"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"}