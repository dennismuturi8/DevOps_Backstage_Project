{"version":3,"file":"Table.esm.js","sources":["../../../../src/components/Table/components/Table.tsx"],"sourcesContent":["/*\n * Copyright 2025 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useId } from 'react-aria';\nimport { type Key, ResizableTableContainer } from 'react-aria-components';\nimport { TableRoot } from './TableRoot';\nimport { TableHeader } from './TableHeader';\nimport { TableBody } from './TableBody';\nimport { Row } from './Row';\nimport { Column } from './Column';\nimport { TablePagination } from '../../TablePagination';\nimport type {\n  TableProps,\n  TableItem,\n  RowConfig,\n  RowRenderFn,\n  TablePaginationType,\n} from '../types';\nimport { Fragment, useMemo } from 'react';\nimport { VisuallyHidden } from '../../VisuallyHidden';\nimport { Flex } from '../../Flex';\n\nfunction isRowRenderFn<T extends TableItem>(\n  rowConfig: RowConfig<T> | RowRenderFn<T> | undefined,\n): rowConfig is RowRenderFn<T> {\n  return typeof rowConfig === 'function';\n}\n\nfunction useDisabledRows<T extends TableItem>({\n  data,\n  rowConfig,\n}: Pick<TableProps<T>, 'data' | 'rowConfig'>): Set<Key> | undefined {\n  return useMemo(() => {\n    if (!data || typeof rowConfig === 'function' || !rowConfig?.getIsDisabled) {\n      return;\n    }\n\n    return data.reduce<Set<Key>>((set, item) => {\n      const isDisabled = rowConfig.getIsDisabled?.(item);\n      if (isDisabled) {\n        set.add(String(item.id));\n      }\n      return set;\n    }, new Set<Key>());\n  }, [data, rowConfig]);\n}\n\nfunction useLiveRegionLabel(\n  pagination: TablePaginationType,\n  isStale: boolean,\n  hasData: boolean,\n): string {\n  if (!hasData || pagination.type === 'none') {\n    return '';\n  }\n\n  const { pageSize, offset, totalCount, getLabel } = pagination;\n\n  if (isStale) {\n    return 'Loading table data.';\n  }\n\n  let liveRegionLabel = 'Table page loaded. ';\n\n  if (getLabel) {\n    liveRegionLabel += getLabel({ pageSize, offset, totalCount });\n  } else if (offset !== undefined) {\n    const fromCount = offset + 1;\n    const toCount = Math.min(offset + pageSize, totalCount ?? 0);\n    liveRegionLabel += `Showing ${fromCount} to ${toCount} of ${totalCount}`;\n  }\n  return liveRegionLabel;\n}\n\n/** @public */\nexport function Table<T extends TableItem>({\n  columnConfig,\n  data,\n  loading = false,\n  isStale = false,\n  error,\n  pagination,\n  sort,\n  rowConfig,\n  selection,\n  emptyState,\n  className,\n  style,\n}: TableProps<T>) {\n  const liveRegionId = useId();\n\n  const visibleColumns = useMemo(\n    () => columnConfig.filter(col => !col.isHidden),\n    [columnConfig],\n  );\n  const disabledRows = useDisabledRows({ data, rowConfig });\n\n  const {\n    mode: selectionMode,\n    selected: selectedKeys,\n    behavior: selectionBehavior,\n    onSelectionChange,\n  } = selection || {};\n\n  if (loading && !data) {\n    return (\n      <div className={className} style={style}>\n        Loading...\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className={className} style={style}>\n        Error: {error.message}\n      </div>\n    );\n  }\n\n  const liveRegionLabel = useLiveRegionLabel(\n    pagination,\n    isStale,\n    data !== undefined,\n  );\n\n  return (\n    <div className={className} style={style}>\n      <VisuallyHidden aria-live=\"polite\" id={liveRegionId}>\n        {liveRegionLabel}\n      </VisuallyHidden>\n\n      <ResizableTableContainer>\n        <TableRoot\n          selectionMode={selectionMode}\n          selectionBehavior={selectionBehavior}\n          selectedKeys={selectedKeys}\n          onSelectionChange={onSelectionChange}\n          sortDescriptor={sort?.descriptor ?? undefined}\n          onSortChange={sort?.onSortChange}\n          disabledKeys={disabledRows}\n          stale={isStale}\n          aria-describedby={liveRegionId}\n        >\n          <TableHeader columns={visibleColumns}>\n            {column =>\n              column.header ? (\n                <>{column.header()}</>\n              ) : (\n                <Column\n                  id={column.id}\n                  isRowHeader={column.isRowHeader}\n                  allowsSorting={column.isSortable}\n                  width={column.width}\n                  defaultWidth={column.defaultWidth}\n                  minWidth={column.minWidth}\n                  maxWidth={column.maxWidth}\n                >\n                  {column.label}\n                </Column>\n              )\n            }\n          </TableHeader>\n          <TableBody\n            items={data}\n            renderEmptyState={\n              emptyState ? () => <Flex p=\"3\">{emptyState}</Flex> : undefined\n            }\n          >\n            {item => {\n              const itemIndex = data?.indexOf(item) ?? -1;\n\n              if (isRowRenderFn(rowConfig)) {\n                return rowConfig({\n                  item,\n                  index: itemIndex,\n                });\n              }\n\n              return (\n                <Row\n                  id={String(item.id)}\n                  columns={visibleColumns}\n                  href={rowConfig?.getHref?.(item)}\n                  onAction={\n                    rowConfig?.onClick\n                      ? () => rowConfig?.onClick?.(item)\n                      : undefined\n                  }\n                >\n                  {column => (\n                    <Fragment key={column.id}>{column.cell(item)}</Fragment>\n                  )}\n                </Row>\n              );\n            }}\n          </TableBody>\n        </TableRoot>\n      </ResizableTableContainer>\n      {pagination.type === 'page' && (\n        <TablePagination\n          pageSize={pagination.pageSize}\n          pageSizeOptions={pagination.pageSizeOptions}\n          offset={pagination.offset}\n          totalCount={pagination.totalCount}\n          hasNextPage={pagination.hasNextPage}\n          hasPreviousPage={pagination.hasPreviousPage}\n          onNextPage={pagination.onNextPage}\n          onPreviousPage={pagination.onPreviousPage}\n          onPageSizeChange={pagination.onPageSizeChange}\n          showPageSizeOptions={pagination.showPageSizeOptions}\n          getLabel={pagination.getLabel}\n        />\n      )}\n    </div>\n  );\n}\n"],"names":["Fragment"],"mappings":"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"}