{"version":3,"file":"ErrorReporting.esm.js","sources":["../../../src/components/ErrorReporting/ErrorReporting.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { useMemo } from 'react';\nimport {\n  ClusterAttributes,\n  DetectedError,\n  DetectedErrorsByCluster,\n} from '@backstage/plugin-kubernetes-common';\nimport { Table, TableColumn } from '@backstage/core-components';\nimport { useTranslationRef } from '@backstage/core-plugin-api/alpha';\nimport { kubernetesReactTranslationRef } from '../../translation';\n\n/**\n *\n *\n * @public\n */\nexport type ErrorReportingProps = {\n  detectedErrors: DetectedErrorsByCluster;\n  clusters: ClusterAttributes[];\n};\n\ninterface Row {\n  cluster: ClusterAttributes;\n  error: DetectedError;\n}\n\nconst sortBySeverity = (a: Row, b: Row) => {\n  if (a.error.severity < b.error.severity) {\n    return 1;\n  } else if (b.error.severity < a.error.severity) {\n    return -1;\n  }\n  return 0;\n};\n\n/**\n *\n *\n * @public\n */\nexport const ErrorReporting = ({\n  detectedErrors,\n  clusters,\n}: ErrorReportingProps) => {\n  const { t } = useTranslationRef(kubernetesReactTranslationRef);\n  const errors = Array.from(detectedErrors.entries())\n    .flatMap(([clusterName, resourceErrors]) => {\n      return resourceErrors.map(e => ({\n        cluster: clusters.find(c => c.name === clusterName)!,\n        error: e,\n      }));\n    })\n    .sort(sortBySeverity);\n\n  const columns: TableColumn<Row>[] = useMemo(\n    () => [\n      {\n        title: String(t('errorReporting.columns.cluster')),\n        width: '10%',\n        render: (row: Row) => row.cluster.title || row.cluster.name,\n      },\n      {\n        title: String(t('errorReporting.columns.namespace')),\n        width: '10%',\n        render: (row: Row) => row.error.sourceRef.namespace,\n      },\n      {\n        title: String(t('errorReporting.columns.kind')),\n        width: '10%',\n        render: (row: Row) => row.error.sourceRef.kind,\n      },\n      {\n        title: String(t('errorReporting.columns.name')),\n        width: '30%',\n        render: (row: Row) => {\n          return <>{row.error.sourceRef.name} </>;\n        },\n      },\n      {\n        title: String(t('errorReporting.columns.messages')),\n        width: '40%',\n        render: (row: Row) => row.error.message,\n      },\n    ],\n    [t],\n  );\n\n  return (\n    <>\n      {errors.length !== 0 && (\n        <Table\n          title={t('errorReporting.title')}\n          data={errors}\n          columns={columns}\n          options={{ paging: true, search: false, emptyRowsWhenPaging: false }}\n        />\n      )}\n    </>\n  );\n};\n"],"names":[],"mappings":"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"}